<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ë—Ä–∏—Ñ ‚Äî –ö–∞—Ä—å–µ—Ä–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è | –ö–ê–ß–ê–õ–ö–ò–ù PRO</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --accent:#9B2FAC;--accent-light:#B044BF;--accent-bg:rgba(155,47,172,.06);
  --accent-ring:rgba(155,47,172,.1);--bg:#FAFAF7;--card:#FFFFFF;
  --text:#1F2017;--text-mid:#555548;--text-light:#93937F;
  --border:#E5E4DB;--input-bg:#FDFDFB;--green:#4A8B6A;--red:#C45D4D;
  --shadow-sm:0 1px 3px rgba(0,0,0,.04);--shadow-md:0 4px 16px rgba(0,0,0,.06);
  --radius:16px;--radius-sm:10px
}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;-webkit-font-smoothing:antialiased}

/* === HEADER === */
.header{background:linear-gradient(135deg,#E91E8C 0%,#9B2FAC 50%,#6B2FA0 100%);position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:-60%;right:-20%;width:400px;height:400px;background:radial-gradient(circle,rgba(255,255,255,.04) 0%,transparent 70%);border-radius:50%}
.header-inner{max-width:640px;margin:0 auto;padding:36px 24px 32px;position:relative;z-index:1}
.logo-row{display:flex;align-items:center;gap:12px;margin-bottom:28px}
.logo-icon{width:44px;height:44px;background:rgba(255,255,255,.12);border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.15);flex-shrink:0}
.logo-icon span{font-weight:700;font-size:13px;color:#fff;letter-spacing:.5px}
.logo-name{font-weight:700;font-size:13px;color:rgba(255,255,255,.8);letter-spacing:2.5px;text-transform:uppercase}
.logo-pro{font-family:'DM Serif Display',serif;font-size:18px;color:rgba(255,255,255,.95)}
.header h1{font-family:'DM Serif Display',serif;font-size:22px;font-weight:400;color:#fff;margin-bottom:10px;line-height:1.35}
.header-desc{font-size:13.5px;color:rgba(255,255,255,.65);line-height:1.7;max-width:480px}

/* === STICKY PROGRESS === */
.progress-wrap{position:sticky;top:0;z-index:100;background:rgba(250,250,247,.95);backdrop-filter:blur(14px);-webkit-backdrop-filter:blur(14px);border-bottom:1px solid var(--border)}
.progress-inner{max-width:640px;margin:0 auto;padding:10px 24px;display:flex;align-items:center;gap:12px}
.progress-track{flex:1;height:4px;background:#E8E7DE;border-radius:2px;overflow:hidden}
.progress-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .5s cubic-bezier(.4,0,.2,1)}
.progress-meta{display:flex;align-items:center;gap:10px;flex-shrink:0}
.progress-text{font-size:11px;font-weight:600;color:var(--accent);white-space:nowrap}
.save-badge{font-size:10px;font-weight:500;color:var(--green);opacity:0;transition:opacity .3s;white-space:nowrap}
.save-badge.show{opacity:1}

/* === ACCORDION BLOCKS === */
.blocks{max-width:640px;margin:0 auto;padding:16px 24px 48px}

.block{margin-bottom:12px;border-radius:var(--radius);overflow:hidden;border:1.5px solid var(--border);background:var(--card);box-shadow:var(--shadow-sm);transition:box-shadow .3s}
.block.open{box-shadow:var(--shadow-md)}

.block-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;cursor:pointer;-webkit-tap-highlight-color:transparent;user-select:none;transition:background .2s}
.block-header:hover{background:rgba(155,47,172,.02)}
.block-header:active{background:rgba(155,47,172,.04)}

.block-left{display:flex;align-items:center;gap:14px}
.block-icon{width:40px;height:40px;background:var(--accent);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;transition:transform .3s}
.block.open .block-icon{transform:scale(1.05)}
.block-title{font-family:'DM Serif Display',serif;font-size:17px;color:var(--text)}
.block-subtitle{font-size:11.5px;color:var(--text-light);margin-top:1px}

.block-right{display:flex;align-items:center;gap:10px}
.block-counter{font-size:11px;font-weight:600;color:var(--text-light);background:#F0EFEA;padding:3px 10px;border-radius:100px;white-space:nowrap}
.block-counter.complete{color:#9B2FAC;background:rgba(155,47,172,.08)}
.block-arrow{width:20px;height:20px;color:var(--text-light);transition:transform .3s;flex-shrink:0}
.block.open .block-arrow{transform:rotate(180deg)}

.block-body{max-height:0;overflow:hidden;transition:max-height .4s cubic-bezier(.4,0,.2,1)}
.block.open .block-body{max-height:none}
.block-content{padding:0 22px 22px}

/* Sub-section divider inside block */
.sub-divider{display:flex;align-items:center;gap:10px;margin:20px 0 14px;padding-top:4px}
.sub-divider-line{flex:1;height:1px;background:var(--border)}
.sub-divider-text{font-size:11px;font-weight:600;color:var(--text-light);text-transform:uppercase;letter-spacing:1.2px;white-space:nowrap}

/* === QUESTION CARD === */
.q-card{background:var(--bg);border-radius:12px;padding:18px 20px;margin-bottom:10px;border:1.5px solid transparent;transition:border-color .25s,box-shadow .25s;position:relative}
.q-card:focus-within{border-color:rgba(155,47,172,.2);box-shadow:0 2px 12px rgba(0,0,0,.04);background:var(--card)}
.q-card.filled{background:rgba(155,47,172,.015);border-color:rgba(155,47,172,.08)}

.q-num{font-size:9.5px;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px}
.q-label-row{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:2px}
.q-label{font-size:13.5px;font-weight:600;color:var(--text);line-height:1.45;cursor:default}
.q-check{color:var(--green);font-size:12px;flex-shrink:0;opacity:0;transition:opacity .25s;margin-top:2px}
.q-card.filled .q-check{opacity:1}
.q-hint{font-size:11.5px;color:var(--text-light);margin-bottom:10px;line-height:1.5;min-height:4px}

textarea,input[type="text"]{width:100%;padding:11px 13px;border:1.5px solid var(--border);border-radius:var(--radius-sm);background:var(--input-bg);font-family:'DM Sans',sans-serif;font-size:14px;color:var(--text);line-height:1.6;transition:border-color .2s,box-shadow .2s;outline:none;-webkit-appearance:none}
textarea{min-height:76px;resize:vertical}
input[type="text"]{height:44px}
textarea::placeholder,input::placeholder{color:#C2C1B5}
textarea:focus,input[type="text"]:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-ring);background:#fff}

/* === CHIPS === */
.chips-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
.chip{font-size:12.5px;font-weight:500;padding:6px 14px;border-radius:100px;border:1.5px solid var(--border);background:var(--card);color:var(--text-mid);cursor:pointer;transition:all .2s;outline:none;-webkit-tap-highlight-color:transparent;user-select:none}
.chip:hover{border-color:var(--accent);color:var(--accent)}
.chip.selected{background:var(--accent);color:#fff;border-color:var(--accent)}
.chip-custom-row{display:flex;gap:6px;align-items:center;margin-top:4px}
.chip-custom-row input{flex:1;height:38px;font-size:12.5px;padding:8px 12px}
.chip-add-btn{font-size:12px;font-weight:600;padding:8px 14px;border-radius:100px;border:none;background:var(--accent-bg);color:var(--accent);cursor:pointer;white-space:nowrap;transition:all .2s}
.chip-add-btn:hover{background:var(--accent);color:#fff}

/* === TOGGLE === */
.toggle-row{display:flex;gap:8px;margin-bottom:10px}
.toggle-btn{flex:1;font-size:13px;font-weight:600;padding:14px 10px 10px;border-radius:12px;border:1.5px solid var(--border);background:var(--card);color:var(--text-mid);cursor:pointer;transition:all .2s;text-align:center;outline:none;-webkit-tap-highlight-color:transparent}
.toggle-btn:hover{border-color:var(--accent);color:var(--accent)}
.toggle-btn.selected{background:var(--accent);color:#fff;border-color:var(--accent)}
.toggle-emoji{font-size:20px;display:block;margin-bottom:4px}

/* === SUBMIT ROW === */
.submit-row{max-width:640px;margin:0 auto;padding:0 24px 48px;text-align:center}
.btn-send{font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;padding:14px 40px;border-radius:100px;border:none;background:var(--accent);color:#fff;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:8px;-webkit-tap-highlight-color:transparent}
.btn-send:hover{background:var(--accent-light);transform:translateY(-1px)}
.btn-send:disabled{opacity:.5;cursor:not-allowed;transform:none!important}
.submit-hint{font-size:11.5px;color:var(--text-light);margin-top:10px}

/* === MODAL === */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(31,32,23,.35);backdrop-filter:blur(4px);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal-overlay.show{display:flex}
.modal-box{background:var(--card);border-radius:18px;padding:28px 24px;max-width:380px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.12);animation:slideUp .3s;text-align:center}
.modal-icon{font-size:30px;margin-bottom:12px}
.modal-title{font-family:'DM Serif Display',serif;font-size:17px;margin-bottom:8px}
.modal-text{font-size:13px;color:var(--text-mid);line-height:1.6;margin-bottom:20px}
.modal-text .warn{color:var(--red);font-weight:500}
.modal-buttons{display:flex;gap:8px;justify-content:center}
.modal-btn{font-size:13px;font-weight:600;padding:9px 20px;border-radius:100px;border:none;cursor:pointer}
.modal-btn-cancel{background:#F0EFEA;color:var(--text-mid)}
.modal-btn-confirm{background:var(--accent);color:#fff}

.overlay{display:none;position:fixed;inset:0;background:rgba(250,250,247,.85);backdrop-filter:blur(6px);z-index:1001;justify-content:center;align-items:center}
.overlay.show{display:flex}
.spinner{width:40px;height:40px;border:3px solid #E8E7DE;border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 14px}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes slideUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.spinner-label{font-size:14px;font-weight:500;color:var(--text-mid);text-align:center}

.error-banner{display:none;max-width:640px;margin:10px auto 0;padding:12px 18px;background:rgba(196,93,77,.06);border:1.5px solid rgba(196,93,77,.18);border-radius:var(--radius-sm);color:var(--red);font-size:13px;font-weight:500;text-align:center;animation:slideUp .3s}
.error-banner.show{display:block}

.done{display:none;max-width:640px;margin:0 auto;padding:80px 24px;text-align:center;animation:slideUp .5s}
.done.show{display:block}
.done-circle{width:72px;height:72px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 22px;font-size:30px;color:#fff}
.done h2{font-family:'DM Serif Display',serif;font-size:22px;font-weight:400;margin-bottom:10px}
.done p{font-size:14px;color:var(--text-mid);max-width:400px;margin:0 auto;line-height:1.7}

.footer{text-align:center;padding:20px 24px 40px;max-width:640px;margin:0 auto}
.footer-bar{width:32px;height:2px;background:var(--accent);border-radius:1px;margin:0 auto 12px;opacity:.3}
.footer p{font-size:10px;font-weight:500;color:var(--text-light);letter-spacing:1px;text-transform:uppercase}

@media(max-width:600px){
  .header-inner{padding:28px 18px 24px}
  .header h1{font-size:19px}
  .blocks{padding:12px 14px 36px}
  .block-header{padding:15px 16px}
  .block-content{padding:0 16px 16px}
  .q-card{padding:14px 16px}
  .progress-inner{padding:8px 14px}
  .submit-row{padding:0 14px 36px}
  .toggle-btn{padding:12px 6px 8px;font-size:12px}
  .chip{font-size:11.5px;padding:5px 12px}
}
</style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div class="logo-row">
      <div class="logo-icon"><span>PRO</span></div>
      <div><div class="logo-name">–ö–ê–ß–ê–õ–ö–ò–ù</div><div class="logo-pro">PRO</div></div>
    </div>
    <h1>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∫–∞—Ä—å–µ—Ä–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h1>
    <p class="header-desc">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ PR. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±—Ä–∏—Ñ ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞—à—É –≤—Å—Ç—Ä–µ—á—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.</p>
  </div>
</div>

<div class="progress-wrap"><div class="progress-inner">
  <div class="progress-track"><div class="progress-fill" id="pFill" style="width:0%"></div></div>
  <div class="progress-meta"><div class="save-badge" id="saveBadge">‚úì —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div><div class="progress-text" id="pText">0 / 20</div></div>
</div></div>

<div class="error-banner" id="errorBanner">–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</div>

<div class="blocks" id="blocks"></div>

<div class="submit-row" id="submitRow">
  <button class="btn-send" id="sendBtn" onclick="preSend()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±—Ä–∏—Ñ ‚úì</button>
  <div class="submit-hint">–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –Ω–µ –≤—Å—ë</div>
</div>

<div class="modal-overlay" id="confirmModal"><div class="modal-box">
  <div class="modal-icon">üìã</div>
  <div class="modal-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±—Ä–∏—Ñ?</div>
  <div class="modal-text" id="modalText"></div>
  <div class="modal-buttons">
    <button class="modal-btn modal-btn-cancel" onclick="closeModal()">–ï—â—ë –∑–∞–ø–æ–ª–Ω—é</button>
    <button class="modal-btn modal-btn-confirm" onclick="confirmSend()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div></div>

<div class="overlay" id="overlay"><div><div class="spinner"></div><div class="spinner-label">–û—Ç–ø—Ä–∞–≤–ª—è—é...</div></div></div>

<div class="done" id="done">
  <div class="done-circle">‚úì</div>
  <h2>–°–ø–∞—Å–∏–±–æ! –ë—Ä–∏—Ñ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</h2>
  <p>–Ø –ø–æ–ª—É—á–∏–ª –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –∏ –Ω–∞—á–∏–Ω–∞—é –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫&nbsp;–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏. –°–∫–æ—Ä–æ —Å–≤—è–∂—É—Å—å. –î–æ –≤—Å—Ç—Ä–µ—á–∏!</p>
</div>

<div class="footer"><div class="footer-bar"></div><p>–ö–ê–ß–ê–õ–ö–ò–ù PRO ¬∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥</p></div>

<script>
const SCRIPT_URL='https://script.google.com/macros/s/AKfycbwpRqyMzV39Snq6VLMVkeVrsioDHIFaVpV6CPBSZpiBbQc5QGrekk2gz4AFnmL4_-HG/exec';
const LS_KEY='kachalkin_brief_v6';

// 4 accordion blocks with sub-sections
const BLOCKS=[
  {
    title:"–û –í–∞—Å",icon:"üë§",sub:"–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –æ–ø—ã—Ç",
    sections:[
      {label:null, questions:[
        {id:"name",l:"–ö–∞–∫ –í–∞—Å –∑–æ–≤—É—Ç?",h:"–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è",type:"input"},
      ]},
      {label:"–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—ã—Ç", questions:[
        {id:"age_education",l:"–°–∫–æ–ª—å–∫–æ –í–∞–º –ª–µ—Ç? –ö–∞–∫–æ–µ —É –í–∞—Å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ?",h:"–í—É–∑, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∏–ª–∏ —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å",type:"textarea"},
        {id:"additional_education",l:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",h:"–ö—É—Ä—Å—ã, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, —Ç—Ä–µ–Ω–∏–Ω–≥–∏",type:"textarea"},
        {id:"experience",l:"–ö–∞–∫–æ–π —É –í–∞—Å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã?",h:"–ö–æ–º–ø–∞–Ω–∏–∏, —Ä–æ–ª–∏, —Å—Ä–æ–∫–∏ ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ —Ç–æ–∂–µ —Å—á–∏—Ç–∞—é—Ç—Å—è",type:"textarea"},
        {id:"languages",l:"–ö–∞–∫–∏–º–∏ —è–∑—ã–∫–∞–º–∏ –í—ã –≤–ª–∞–¥–µ–µ—Ç–µ?",h:"–í—ã–±–µ—Ä–∏—Ç–µ –∏ —É–∫–∞–∂–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∂–µ",type:"chips",
          chips:["–†—É—Å—Å–∫–∏–π","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π","–ù–µ–º–µ—Ü–∫–∏–π","–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π","–ò—Å–ø–∞–Ω—Å–∫–∏–π","–ö–∏—Ç–∞–π—Å–∫–∏–π"],
          customPlaceholder:"–î—Ä—É–≥–æ–π —è–∑—ã–∫",
          textPlaceholder:"–£–∫–∞–∂–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å: –Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π B2"},
      ]},
    ]
  },
  {
    title:"–°–∏—Ç—É–∞—Ü–∏—è –∏ –∑–∞–ø—Ä–æ—Å",icon:"üéØ",sub:"–ß–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å",
    sections:[
      {label:"–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è", questions:[
        {id:"current_situation",l:"–ß–µ–º –í—ã –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å —Å–µ–π—á–∞—Å?",h:"–†–∞–±–æ—Ç–∞, —É—á—ë–±–∞, –ø—Ä–æ–µ–∫—Ç—ã",type:"textarea"},
        {id:"likes_dislikes",l:"–ß—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è –≤ —Ç–æ–º, —á–µ–º –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å, –∞ —á—Ç–æ ‚Äî –Ω–µ—Ç?",h:"",type:"textarea"},
        {id:"strengths",l:"–ö–∞–∫–∏–µ —É –í–∞—Å —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã?",h:"–ß—Ç–æ —Ö–æ—Ä–æ—à–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è? –ú–æ–∂–Ω–æ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏",type:"textarea"},
        {id:"challenges",l:"–ß—Ç–æ –¥–∞—ë—Ç—Å—è —Ç—è–∂–µ–ª–æ –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ?",h:"",type:"textarea"},
        {id:"ai_usage",l:"–ü–æ–ª—å–∑—É–µ—Ç–µ—Å—å –ª–∏ –í—ã –ò–ò-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏?",h:"–í—ã–±–µ—Ä–∏—Ç–µ –∏ —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –∫–∞–∫",type:"chips",
          chips:["ChatGPT","Claude","Midjourney","Copilot","Perplexity","YandexGPT","–ù–µ –ø–æ–ª—å–∑—É—é—Å—å"],
          customPlaceholder:"–î—Ä—É–≥–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç",
          textPlaceholder:"–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ: –≤ —É—á—ë–±–µ, —Ä–∞–±–æ—Ç–µ, –∂–∏–∑–Ω–∏"},
      ]},
      {label:"–ó–∞–ø—Ä–æ—Å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é", questions:[
        {id:"main_question",l:"–ì–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ —Ä–µ—à–∏—Ç—å",h:"–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –∫–∞–∫ –º–æ–∂–µ—Ç–µ",type:"textarea"},
        {id:"interests",l:"–ö–∞–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞/PR –í–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã?",h:"–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ",type:"chips",
          chips:["–ë—Ä–µ–Ω–¥-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç","Digital-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥","–ö–æ–Ω—Ç–µ–Ω—Ç","PR –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏","–ê–≥–µ–Ω—Ç—Å—Ç–≤–æ","–õ–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥","Event","–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥","–ê–Ω–∞–ª–∏—Ç–∏–∫–∞","Influence-–º–∞—Ä–∫–µ—Ç–∏–Ω–≥"],
          customPlaceholder:"–°–≤–æ—ë –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
          textPlaceholder:"–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ"},
        {id:"role_models",l:"–ö–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –ª—é–¥–∏-–æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã –≤ –∫–∞—Ä—å–µ—Ä–µ",h:"–ù–∞ –∫–æ–≥–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—Ç–µ—Å—å?",type:"textarea"},
      ]},
    ]
  },
  {
    title:"–ë—É–¥—É—â–µ–µ –∏ —Ä–µ—Å—É—Ä—Å—ã",icon:"‚ú®",sub:"–û–±—Ä–∞–∑ –∂–∏–∑–Ω–∏ —á–µ—Ä–µ–∑ 5‚Äì10 –ª–µ—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ",
    sections:[
      {label:"–û–±—Ä–∞–∑ –±—É–¥—É—â–µ–≥–æ", questions:[
        {id:"career_3_5",l:"–ß—Ç–æ –¥–ª—è –í–∞—Å ¬´—É—Å–ø–µ—à–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞¬ª —á–µ—Ä–µ–∑ 3‚Äì5 –ª–µ—Ç?",h:"",type:"textarea"},
        {id:"life_5_10",l:"–ö–∞–∫ –í—ã –≤–∏–¥–∏—Ç–µ —Å–≤–æ—é –∂–∏–∑–Ω—å —á–µ—Ä–µ–∑ 5‚Äì10 –ª–µ—Ç?",h:"–ù–µ —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ ‚Äî —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏",type:"textarea"},
      ]},
      {label:"–†–µ—Å—É—Ä—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è", questions:[
        {id:"health",l:"–ö–∞–∫ –í—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ?",h:"–§–∏–∑–∏—á–µ—Å–∫–æ–µ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ. –ß—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –í–∞—à—É —ç–Ω–µ—Ä–≥–∏—é?",type:"textarea"},
        {id:"constraints",l:"–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å",h:"–í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ",type:"chips",
          chips:["–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–§–∏–Ω–∞–Ω—Å—ã","–í—Ä–µ–º—è","–°–µ–º–µ–π–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞","–ó–¥–æ—Ä–æ–≤—å–µ"],
          customPlaceholder:"–î—Ä—É–≥–æ–µ",
          textPlaceholder:"–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"},
        {id:"previous_attempts",l:"–ß—Ç–æ –í—ã —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞?",h:"–ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∞ —á—Ç–æ –Ω–µ—Ç?",type:"textarea"},
      ]},
    ]
  },
  {
    title:"–í—Å—Ç—Ä–µ—á–∞",icon:"üìÖ",sub:"–§–æ—Ä–º–∞—Ç –∏ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è",
    sections:[
      {label:null, questions:[
        {id:"format_preference",l:"–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –≤—Å—Ç—Ä–µ—á–∏ –í–∞–º —É–¥–æ–±–Ω–µ–µ?",h:"",type:"toggle",
          options:[
            {value:"–û—á–Ω–æ",emoji:"üè¢",sub:"–í—Å—Ç—Ä–µ—Ç–∏–º—Å—è –ª–∏—á–Ω–æ"},
            {value:"–û–Ω–ª–∞–π–Ω",emoji:"üíª",sub:"Zoom / Google Meet"},
            {value:"–ë–µ–∑ —Ä–∞–∑–Ω–∏—Ü—ã",emoji:"ü§ù",sub:"–õ—é–±–æ–π –≤–∞—Ä–∏–∞–Ω—Ç"}
          ],
          textPlaceholder:"–ï—Å–ª–∏ –æ—á–Ω–æ ‚Äî —É–∫–∞–∂–∏—Ç–µ —É–¥–æ–±–Ω—ã–π —Ä–∞–π–æ–Ω –∏–ª–∏ –≥–æ—Ä–æ–¥"},
        {id:"preferred_datetime",l:"–ö–æ–≥–¥–∞ –í–∞–º —É–¥–æ–±–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é?",h:"–î–Ω–∏ –Ω–µ–¥–µ–ª–∏, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã",type:"textarea"},
        {id:"additional",l:"–ß—Ç–æ-—Ç–æ –µ—â—ë, —á—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –ø–µ—Ä–µ–¥ –≤—Å—Ç—Ä–µ—á–µ–π?",h:"–õ—é–±—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –≤–æ–ø—Ä–æ—Å—ã",type:"textarea"},
      ]},
    ]
  }
];

// Flatten all questions for counting
const ALL_Q=[];
let qNum=0;
BLOCKS.forEach(b=>b.sections.forEach(s=>s.questions.forEach(q=>{qNum++;q._n=qNum;ALL_Q.push(q)})));
const TQ=ALL_Q.length;

let A={},chips_data={},openBlocks={0:true},saveT=null;

function saveLS(){try{localStorage.setItem(LS_KEY,JSON.stringify({a:A,ch:chips_data,ob:openBlocks}))}catch(e){}}
function loadLS(){try{const d=JSON.parse(localStorage.getItem(LS_KEY));if(d&&d.a){A=d.a;chips_data=d.ch||{};if(d.ob)openBlocks=d.ob}}catch(e){}}
function clearLS(){try{localStorage.removeItem(LS_KEY)}catch(e){}}
function flashSave(){const b=document.getElementById('saveBadge');b.classList.add('show');clearTimeout(saveT);saveT=setTimeout(()=>b.classList.remove('show'),1500)}

window.addEventListener('beforeunload',function(e){if(cnt()>0&&!document.getElementById('done').classList.contains('show')){e.preventDefault();e.returnValue=''}});

const esc=s=>s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const cnt=()=>ALL_Q.filter(q=>A[q.id]&&A[q.id].trim()).length;

function blockCnt(bi){
  let filled=0,total=0;
  BLOCKS[bi].sections.forEach(s=>s.questions.forEach(q=>{total++;if(A[q.id]&&A[q.id].trim())filled++}));
  return{filled,total};
}

function updProg(){
  const c=cnt();
  document.getElementById('pFill').style.width=Math.round(c/TQ*100)+'%';
  document.getElementById('pText').textContent=c+' / '+TQ;
}

function buildAnswer(q){
  if(q.type==='chips'||q.type==='toggle'){
    const cv=(chips_data[q.id]||[]).join(', ');
    const tv=(A[q.id+'_text']||'').trim();
    const parts=[];if(cv)parts.push(cv);if(tv)parts.push(tv);
    return parts.join('. ');
  }
  return A[q.id]||'';
}

function syncChipAnswer(q){
  A[q.id]=buildAnswer(q);
  updProg();saveLS();flashSave();
  const card=document.getElementById('card_'+q.id);
  if(card){if(A[q.id]&&A[q.id].trim())card.classList.add('filled');else card.classList.remove('filled')}
  updBlockCounters();
}

function updBlockCounters(){
  BLOCKS.forEach((b,i)=>{
    const el=document.getElementById('bcnt_'+i);
    if(!el)return;
    const{filled,total}=blockCnt(i);
    el.textContent=filled+' / '+total;
    if(filled===total&&total>0)el.classList.add('complete');else el.classList.remove('complete');
  });
}

function toggleBlock(i){
  openBlocks[i]=!openBlocks[i];
  const block=document.getElementById('block_'+i);
  if(openBlocks[i]){
    block.classList.add('open');
  }else{
    block.classList.remove('open');
  }
  saveLS();
}

function render(){
  const container=document.getElementById('blocks');
  let html='';

  BLOCKS.forEach((block,bi)=>{
    const{filled,total}=blockCnt(bi);
    const isOpen=openBlocks[bi];

    html+='<div class="block'+(isOpen?' open':'')+'" id="block_'+bi+'">';

    // Header
    html+='<div class="block-header" onclick="toggleBlock('+bi+')">';
    html+='<div class="block-left"><div class="block-icon">'+block.icon+'</div><div><div class="block-title">'+block.title+'</div><div class="block-subtitle">'+block.sub+'</div></div></div>';
    html+='<div class="block-right"><div class="block-counter'+(filled===total&&total>0?' complete':'')+'" id="bcnt_'+bi+'">'+filled+' / '+total+'</div>';
    html+='<svg class="block-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>';
    html+='</div></div>';

    // Body
    html+='<div class="block-body"><div class="block-content">';

    block.sections.forEach((sec,si)=>{
      if(sec.label){
        html+='<div class="sub-divider"><div class="sub-divider-line"></div><div class="sub-divider-text">'+sec.label+'</div><div class="sub-divider-line"></div></div>';
      }

      sec.questions.forEach(q=>{
        const v=A[q.id]||'';
        const f=v.trim()?' filled':'';
        html+='<div class="q-card'+f+'" id="card_'+q.id+'">';
        html+='<div class="q-num">–í–æ–ø—Ä–æ—Å '+q._n+'</div>';
        html+='<div class="q-label-row"><label class="q-label">'+q.l+'</label><span class="q-check">‚úì</span></div>';
        if(q.h)html+='<div class="q-hint">'+q.h+'</div>';else html+='<div class="q-hint"></div>';

        if(q.type==='input'){
          html+='<input type="text" id="inp_'+q.id+'" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç..." value="'+esc(v)+'">';
        }else if(q.type==='chips'){
          const sel=chips_data[q.id]||[];
          html+='<div class="chips-wrap" id="chips_'+q.id+'">';
          q.chips.forEach(c=>{html+='<button type="button" class="chip'+(sel.includes(c)?' selected':'')+'" data-qid="'+q.id+'" data-val="'+esc(c)+'">'+c+'</button>'});
          html+='</div>';
          html+='<div class="chip-custom-row"><input type="text" id="customchip_'+q.id+'" placeholder="'+(q.customPlaceholder||'–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç')+'"><button type="button" class="chip-add-btn" data-qid="'+q.id+'">+</button></div>';
          const tv=A[q.id+'_text']||'';
          html+='<textarea id="inp_'+q.id+'_text" placeholder="'+(q.textPlaceholder||'–ü–æ–¥—Ä–æ–±–Ω–µ–µ')+'" style="margin-top:8px;min-height:56px">'+esc(tv)+'</textarea>';
        }else if(q.type==='toggle'){
          const sel=chips_data[q.id]||[];
          html+='<div class="toggle-row" id="toggle_'+q.id+'">';
          q.options.forEach(o=>{html+='<button type="button" class="toggle-btn'+(sel.includes(o.value)?' selected':'')+'" data-qid="'+q.id+'" data-val="'+esc(o.value)+'"><span class="toggle-emoji">'+o.emoji+'</span>'+o.value+'</button>'});
          html+='</div>';
          const tv=A[q.id+'_text']||'';
          html+='<textarea id="inp_'+q.id+'_text" placeholder="'+(q.textPlaceholder||'–£—Ç–æ—á–Ω–∏')+'" style="min-height:56px">'+esc(tv)+'</textarea>';
        }else{
          html+='<textarea id="inp_'+q.id+'" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">'+esc(v)+'</textarea>';
        }
        html+='</div>';
      });
    });

    html+='</div></div></div>';
  });

  container.innerHTML=html;
  bindEvents();
}

function bindEvents(){
  ALL_Q.forEach(q=>{
    if(q.type==='input'||q.type==='textarea'){
      const inp=document.getElementById('inp_'+q.id);
      if(inp)inp.addEventListener('input',function(){
        A[q.id]=this.value;updProg();saveLS();flashSave();
        const card=document.getElementById('card_'+q.id);
        if(this.value.trim())card.classList.add('filled');else card.classList.remove('filled');
        updBlockCounters();
      });
    }
    if(q.type==='chips'){
      document.querySelectorAll('.chip[data-qid="'+q.id+'"]').forEach(btn=>{
        btn.addEventListener('click',function(){
          if(!chips_data[q.id])chips_data[q.id]=[];
          const val=this.dataset.val;
          if(chips_data[q.id].includes(val)){chips_data[q.id]=chips_data[q.id].filter(v=>v!==val);this.classList.remove('selected')}
          else{chips_data[q.id].push(val);this.classList.add('selected')}
          syncChipAnswer(q);
        });
      });
      const addBtn=document.querySelector('.chip-add-btn[data-qid="'+q.id+'"]');
      const customInp=document.getElementById('customchip_'+q.id);
      if(addBtn&&customInp){
        const doAdd=()=>{
          const val=customInp.value.trim();if(!val)return;
          if(!chips_data[q.id])chips_data[q.id]=[];
          if(!chips_data[q.id].includes(val)){
            chips_data[q.id].push(val);
            const wrap=document.getElementById('chips_'+q.id);
            const nc=document.createElement('button');nc.type='button';nc.className='chip selected';
            nc.dataset.qid=q.id;nc.dataset.val=val;nc.textContent=val;
            nc.addEventListener('click',function(){chips_data[q.id]=chips_data[q.id].filter(v=>v!==val);this.remove();syncChipAnswer(q)});
            wrap.appendChild(nc);
          }
          customInp.value='';syncChipAnswer(q);
        };
        addBtn.addEventListener('click',doAdd);
        customInp.addEventListener('keydown',function(e){if(e.key==='Enter'){e.preventDefault();doAdd()}});
      }
      const ta=document.getElementById('inp_'+q.id+'_text');
      if(ta)ta.addEventListener('input',function(){A[q.id+'_text']=this.value;syncChipAnswer(q)});
    }
    if(q.type==='toggle'){
      document.querySelectorAll('.toggle-btn[data-qid="'+q.id+'"]').forEach(btn=>{
        btn.addEventListener('click',function(){
          chips_data[q.id]=[this.dataset.val];
          document.querySelectorAll('.toggle-btn[data-qid="'+q.id+'"]').forEach(b=>b.classList.remove('selected'));
          this.classList.add('selected');syncChipAnswer(q);
        });
      });
      const ta=document.getElementById('inp_'+q.id+'_text');
      if(ta)ta.addEventListener('input',function(){A[q.id+'_text']=this.value;syncChipAnswer(q)});
    }
  });
}

function preSend(){
  const filled=cnt(),empty=TQ-filled;
  let msg='';
  if(empty===TQ)msg='<span class="warn">–í—Å–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ.</span> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π –±—Ä–∏—Ñ?';
  else if(empty>0)msg='–ó–∞–ø–æ–ª–Ω–µ–Ω–æ <strong>'+filled+' –∏–∑ '+TQ+'</strong>. –ü—Ä–æ–ø—É—â–µ–Ω–æ: '+empty+'.<br>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å?';
  else msg='–í—Å–µ <strong>'+TQ+'</strong> –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!';
  document.getElementById('modalText').innerHTML=msg;
  document.getElementById('confirmModal').classList.add('show');
}
function closeModal(){document.getElementById('confirmModal').classList.remove('show')}

async function confirmSend(){
  closeModal();
  const btn=document.getElementById('sendBtn');btn.disabled=true;
  document.getElementById('overlay').classList.add('show');
  document.getElementById('errorBanner').classList.remove('show');
  let ok=false;
  try{
    const p=new URLSearchParams();
    for(const[k,v]of Object.entries(A))p.append(k,v||'');
    await fetch(SCRIPT_URL,{method:'POST',body:p});ok=true;
  }catch(e){
    try{const p=new URLSearchParams();for(const[k,v]of Object.entries(A))p.append(k,v||'');await fetch(SCRIPT_URL,{method:'POST',mode:'no-cors',body:p});ok=true}catch(e2){}
  }
  document.getElementById('overlay').classList.remove('show');
  if(ok){
    clearLS();
    document.getElementById('blocks').style.display='none';
    document.getElementById('submitRow').style.display='none';
    document.getElementById('done').classList.add('show');
    document.getElementById('pFill').style.width='100%';
  }else{
    btn.disabled=false;
    document.getElementById('errorBanner').classList.add('show');
    setTimeout(()=>document.getElementById('errorBanner').classList.remove('show'),6000);
  }
}

loadLS();render();updProg();
</script>
</body>
</html>
