<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–ë—Ä–∏—Ñ ‚Äî –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∫–∞—Ä—å–µ—Ä–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ | –ö–ê–ß–ê–õ–ö–ò–ù PRO</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --pink: #E91E8C;
  --purple: #6B2FA0;
  --gradient: linear-gradient(135deg, #E91E8C 0%, #9B2FAF 50%, #6B2FA0 100%);
  --bg: #F8F6FB;
  --card: #FFFFFF;
  --text: #1A1A2E;
  --text-mid: #4A4A60;
  --text-light: #8888A0;
  --border: #EBE6F2;
  --input-bg: #FCFAFE;
  --focus-ring: rgba(233, 30, 140, 0.12);
  --green: #22C55E;
  --red: #EF4444;
  --shadow-sm: 0 1px 4px rgba(107, 47, 160, 0.05);
  --shadow-md: 0 4px 24px rgba(107, 47, 160, 0.07);
  --radius: 16px;
  --radius-sm: 12px;
}

html { scroll-behavior: auto; }

body {
  font-family: 'Inter', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* === HEADER ‚Äî collapsible === */
.header {
  background: var(--gradient);
  position: relative;
  overflow: hidden;
  transition: max-height 0.5s ease, padding 0.5s ease;
}

.header::before {
  content: '';
  position: absolute;
  top: -40%; right: -15%;
  width: 500px; height: 500px;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  border-radius: 50%;
}

.header-inner {
  max-width: 700px;
  margin: 0 auto;
  padding: 44px 28px 40px;
  position: relative;
  z-index: 1;
}

.header.compact .header-inner { padding: 20px 28px 16px; }
.header.compact .header-desc,
.header.compact .header h1 { display: none; }

.logo-row {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 36px;
}

.header.compact .logo-row { margin-bottom: 0; }

.logo-icon {
  width: 56px; height: 56px;
  background: rgba(255,255,255,0.18);
  backdrop-filter: blur(12px);
  border-radius: 13px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid rgba(255,255,255,0.22);
  flex-shrink: 0;
  transition: all 0.3s ease;
}

.header.compact .logo-icon { width: 40px; height: 40px; }

.logo-icon span {
  font-family: 'Montserrat', sans-serif;
  font-weight: 900;
  font-size: 17px;
  color: #fff;
}

.header.compact .logo-icon span { font-size: 13px; }

.logo-name {
  font-family: 'Montserrat', sans-serif;
  font-weight: 800;
  font-size: 16px;
  color: #fff;
  letter-spacing: 3px;
  text-transform: uppercase;
}

.logo-pro {
  font-family: 'Montserrat', sans-serif;
  font-weight: 900;
  font-size: 22px;
  color: rgba(255,255,255,0.92);
}

.header.compact .logo-name { font-size: 13px; letter-spacing: 2px; }
.header.compact .logo-pro { font-size: 16px; }

.header h1 {
  font-family: 'Montserrat', sans-serif;
  font-size: 26px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 14px;
  line-height: 1.3;
}

.header-desc {
  font-size: 14.5px;
  color: rgba(255,255,255,0.82);
  line-height: 1.75;
  max-width: 540px;
}

/* === STICKY PROGRESS === */
.progress-wrap {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(235,230,242,0.6);
}

.progress-inner {
  max-width: 700px;
  margin: 0 auto;
  padding: 10px 28px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.progress-track {
  flex: 1;
  height: 5px;
  background: #EDE8F5;
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--gradient);
  border-radius: 3px;
  transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}

.progress-text {
  font-family: 'Montserrat', sans-serif;
  font-size: 11px;
  font-weight: 700;
  color: var(--purple);
  white-space: nowrap;
}

.save-badge {
  font-family: 'Montserrat', sans-serif;
  font-size: 10px;
  font-weight: 600;
  color: var(--green);
  opacity: 0;
  transition: opacity 0.3s ease;
  white-space: nowrap;
  display: flex;
  align-items: center;
  gap: 3px;
}

.save-badge.show { opacity: 1; }

/* === SECTION DOTS (mini-progress under tabs) === */
.section-dots {
  max-width: 700px;
  margin: 0 auto;
  padding: 6px 28px 0;
  display: flex;
  gap: 4px;
}

.s-dot {
  flex: 1;
  height: 3px;
  border-radius: 2px;
  background: #EDE8F5;
  transition: background 0.3s ease;
}

.s-dot.done { background: var(--gradient); }
.s-dot.active { background: var(--pink); opacity: 0.5; }

/* === TABS === */
.tabs-scroll {
  max-width: 700px;
  margin: 0 auto;
  padding: 14px 28px 0;
  display: flex;
  gap: 6px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.tabs-scroll::-webkit-scrollbar { display: none; }

.tab-btn {
  font-family: 'Montserrat', sans-serif;
  font-size: 11.5px;
  font-weight: 600;
  padding: 7px 15px;
  border-radius: 100px;
  border: 1.5px solid var(--border);
  background: var(--card);
  color: var(--text-light);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.25s ease;
  outline: none;
  -webkit-tap-highlight-color: transparent;
  position: relative;
}

.tab-btn:hover { border-color: var(--pink); color: var(--pink); }

.tab-btn.active {
  background: var(--gradient);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 3px 14px rgba(233, 30, 140, 0.28);
}

.tab-btn .cm { margin-left: 3px; font-size: 10px; }

/* First visit hint */
.tabs-hint {
  max-width: 700px;
  margin: 0 auto;
  padding: 6px 28px 0;
  font-size: 11px;
  color: var(--text-light);
  text-align: center;
  opacity: 0.7;
  transition: opacity 0.5s ease;
}

.tabs-hint.hidden { opacity: 0; height: 0; padding: 0; overflow: hidden; }

/* === FORM === */
.form-area {
  max-width: 700px;
  margin: 0 auto;
  padding: 16px 28px 48px;
}

.section { animation: slideUp 0.3s ease forwards; }

@keyframes slideUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.section-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  padding-top: 4px;
}

.section-head-left {
  display: flex;
  align-items: center;
  gap: 14px;
}

.section-badge {
  width: 42px; height: 42px;
  background: var(--gradient);
  border-radius: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 19px;
  box-shadow: 0 4px 14px rgba(233, 30, 140, 0.2);
  flex-shrink: 0;
}

.section-name {
  font-family: 'Montserrat', sans-serif;
  font-size: 19px;
  font-weight: 700;
  color: var(--text);
}

.section-qty {
  font-size: 12px;
  color: var(--text-light);
  margin-top: 2px;
}

/* Section mini-progress */
.section-progress {
  font-family: 'Montserrat', sans-serif;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-light);
  background: var(--bg);
  padding: 4px 12px;
  border-radius: 100px;
  white-space: nowrap;
}

.section-progress.complete {
  color: var(--green);
  background: rgba(34, 197, 94, 0.08);
}

/* === QUESTION CARD === */
.q-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 24px 26px;
  margin-bottom: 12px;
  border: 1.5px solid var(--border);
  transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
  box-shadow: var(--shadow-sm);
  position: relative;
}

.q-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 3px; height: 0;
  background: var(--gradient);
  border-radius: 3px 0 0 3px;
  transition: height 0.4s ease;
}

.q-card:focus-within {
  border-color: rgba(233, 30, 140, 0.25);
  box-shadow: var(--shadow-md);
}

.q-card:focus-within::before { height: 100%; }

.q-card.filled {
  border-color: rgba(107, 47, 160, 0.15);
  background: linear-gradient(135deg, rgba(233,30,140,0.015), rgba(107,47,160,0.025));
}

.q-card.filled::before { height: 100%; opacity: 0.5; }

.q-num {
  font-family: 'Montserrat', sans-serif;
  font-size: 10px;
  font-weight: 700;
  color: var(--pink);
  text-transform: uppercase;
  letter-spacing: 1.8px;
  margin-bottom: 6px;
}

.q-label-row {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 3px;
}

.q-label {
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  line-height: 1.5;
}

label.q-label { cursor: default; }

.q-filled-check {
  color: var(--green);
  font-size: 14px;
  flex-shrink: 0;
  opacity: 0;
  transition: opacity 0.3s ease;
  margin-top: 3px;
}

.q-card.filled .q-filled-check { opacity: 1; }

.q-hint {
  font-size: 12.5px;
  color: var(--text-light);
  margin-bottom: 14px;
  line-height: 1.55;
}

.q-hint:empty { margin-bottom: 14px; }

textarea, input[type="text"] {
  width: 100%;
  padding: 13px 15px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--input-bg);
  font-family: 'Inter', sans-serif;
  font-size: 14px;
  color: var(--text);
  line-height: 1.65;
  transition: border-color 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
  outline: none;
  -webkit-appearance: none;
}

textarea { min-height: 88px; resize: vertical; }
input[type="text"] { height: 48px; }

textarea::placeholder, input::placeholder { color: #C0BCD0; }

textarea:focus, input[type="text"]:focus {
  border-color: var(--pink);
  background: #fff;
  box-shadow: 0 0 0 4px var(--focus-ring);
}

/* === NAV BUTTONS === */
.nav-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 24px;
  gap: 12px;
}

.btn {
  font-family: 'Montserrat', sans-serif;
  font-weight: 600;
  border-radius: 100px;
  border: none;
  cursor: pointer;
  transition: all 0.25s ease;
  display: inline-flex;
  align-items: center;
  gap: 7px;
  outline: none;
  -webkit-tap-highlight-color: transparent;
}

.btn-back {
  font-size: 13px;
  padding: 11px 22px;
  background: var(--card);
  color: var(--text-light);
  border: 1.5px solid var(--border);
}
.btn-back:hover { border-color: var(--purple); color: var(--purple); }

.btn-fwd {
  font-size: 13px;
  padding: 11px 26px;
  background: var(--gradient);
  color: #fff;
  box-shadow: 0 4px 16px rgba(233, 30, 140, 0.22);
}
.btn-fwd:hover { box-shadow: 0 6px 24px rgba(233, 30, 140, 0.32); transform: translateY(-1px); }

.btn-send {
  font-size: 14px;
  padding: 13px 32px;
  background: var(--gradient);
  color: #fff;
  box-shadow: 0 4px 20px rgba(233, 30, 140, 0.25);
}
.btn-send:hover { box-shadow: 0 6px 28px rgba(233, 30, 140, 0.38); transform: translateY(-1px); }
.btn-send:disabled { opacity: 0.55; cursor: not-allowed; transform: none !important; box-shadow: none; }

/* === CONFIRM MODAL === */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(26, 26, 46, 0.4);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.modal-overlay.show { display: flex; }

.modal-box {
  background: var(--card);
  border-radius: 20px;
  padding: 32px 28px;
  max-width: 420px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.15);
  animation: slideUp 0.3s ease;
  text-align: center;
}

.modal-icon {
  font-size: 36px;
  margin-bottom: 16px;
}

.modal-title {
  font-family: 'Montserrat', sans-serif;
  font-size: 17px;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
}

.modal-text {
  font-size: 13.5px;
  color: var(--text-mid);
  line-height: 1.6;
  margin-bottom: 24px;
}

.modal-text .warn { color: var(--red); font-weight: 500; }

.modal-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
}

.modal-btn {
  font-family: 'Montserrat', sans-serif;
  font-size: 13px;
  font-weight: 600;
  padding: 10px 24px;
  border-radius: 100px;
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
}

.modal-btn-cancel {
  background: var(--bg);
  color: var(--text-mid);
}

.modal-btn-confirm {
  background: var(--gradient);
  color: #fff;
  box-shadow: 0 3px 12px rgba(233, 30, 140, 0.2);
}

/* === SENDING OVERLAY === */
.overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(248,246,251,0.88);
  backdrop-filter: blur(6px);
  z-index: 1001;
  justify-content: center;
  align-items: center;
}
.overlay.show { display: flex; }

.spinner {
  width: 44px; height: 44px;
  border: 3px solid #EDE8F5;
  border-top-color: var(--pink);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  margin: 0 auto 16px;
}
@keyframes spin { to { transform: rotate(360deg); } }

.spinner-label {
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-mid);
  text-align: center;
}

/* === ERROR === */
.error-banner {
  display: none;
  max-width: 700px;
  margin: 12px auto 0;
  padding: 14px 20px;
  background: rgba(239, 68, 68, 0.06);
  border: 1.5px solid rgba(239, 68, 68, 0.2);
  border-radius: var(--radius-sm);
  color: var(--red);
  font-size: 13px;
  font-weight: 500;
  text-align: center;
  animation: slideUp 0.3s ease;
}
.error-banner.show { display: block; }

/* === DONE === */
.done {
  display: none;
  max-width: 700px;
  margin: 0 auto;
  padding: 80px 28px;
  text-align: center;
  animation: slideUp 0.5s ease;
}
.done.show { display: block; }

.done-circle {
  width: 76px; height: 76px;
  background: var(--gradient);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 24px;
  box-shadow: 0 8px 32px rgba(233, 30, 140, 0.25);
  font-size: 32px;
  color: #fff;
}

.done h2 {
  font-family: 'Montserrat', sans-serif;
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 12px;
}

.done p {
  font-size: 14.5px;
  color: var(--text-mid);
  max-width: 420px;
  margin: 0 auto;
  line-height: 1.7;
}

/* === FOOTER === */
.footer {
  text-align: center;
  padding: 28px 28px 44px;
  max-width: 700px;
  margin: 0 auto;
}

.footer-bar {
  width: 36px; height: 3px;
  background: var(--gradient);
  border-radius: 2px;
  margin: 0 auto 14px;
}

.footer p {
  font-family: 'Montserrat', sans-serif;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-light);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

@media (max-width: 600px) {
  .header-inner { padding: 36px 20px 28px; }
  .header.compact .header-inner { padding: 14px 20px 12px; }
  .header h1 { font-size: 21px; }
  .header-desc { font-size: 13px; }
  .form-area { padding: 14px 16px 36px; }
  .tabs-scroll { padding: 12px 16px 0; }
  .section-dots { padding: 6px 16px 0; }
  .q-card { padding: 18px 16px; }
  .logo-icon { width: 48px; height: 48px; }
  .header.compact .logo-icon { width: 36px; height: 36px; }
  .logo-icon span { font-size: 15px; }
  .header.compact .logo-icon span { font-size: 11px; }
  .logo-name { font-size: 14px; letter-spacing: 2.5px; }
  .logo-pro { font-size: 19px; }
  .progress-inner { padding: 8px 16px; }
  .tabs-hint { padding: 4px 16px 0; font-size: 10px; }
}
</style>
</head>
<body>

<div class="header" id="header">
  <div class="header-inner">
    <div class="logo-row">
      <div class="logo-icon"><span>PRO</span></div>
      <div>
        <div class="logo-name">–ö–ê–ß–ê–õ–ö–ò–ù</div>
        <div class="logo-pro">PRO</div>
      </div>
    </div>
    <h1>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ –∫–∞—Ä—å–µ—Ä–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h1>
    <p class="header-desc">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –∏ PR –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ. –ó–∞–ø–æ–ª–Ω–∏ –±—Ä–∏—Ñ ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –º–Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–µ –∏ —Å–¥–µ–ª–∞—Ç—å –µ—ë –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–µ–∑–Ω–æ–π –¥–ª—è —Ç–µ–±—è.</p>
  </div>
</div>

<div class="progress-wrap">
  <div class="progress-inner">
    <div class="progress-track">
      <div class="progress-fill" id="pFill" style="width:0%"></div>
    </div>
    <div class="progress-meta">
      <div class="save-badge" id="saveBadge">‚úì —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
      <div class="progress-text" id="pText">0 / 20</div>
    </div>
  </div>
</div>

<div class="section-dots" id="sDots"></div>
<div class="tabs-scroll" id="tabs"></div>
<div class="tabs-hint" id="tabsHint">‚Üê –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ ‚Üí</div>

<div class="error-banner" id="errorBanner">–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.</div>

<div class="form-area" id="formArea"></div>

<div class="modal-overlay" id="confirmModal">
  <div class="modal-box">
    <div class="modal-icon">üìã</div>
    <div class="modal-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±—Ä–∏—Ñ?</div>
    <div class="modal-text" id="modalText"></div>
    <div class="modal-buttons">
      <button class="modal-btn modal-btn-cancel" onclick="closeModal()">–ï—â—ë –∑–∞–ø–æ–ª–Ω—é</button>
      <button class="modal-btn modal-btn-confirm" onclick="confirmSend()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div>
    <div class="spinner"></div>
    <div class="spinner-label">–û—Ç–ø—Ä–∞–≤–ª—è—é –æ—Ç–≤–µ—Ç—ã...</div>
  </div>
</div>

<div class="done" id="done">
  <div class="done-circle">‚úì</div>
  <h2>–°–ø–∞—Å–∏–±–æ! –ë—Ä–∏—Ñ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω</h2>
  <p>–Ø –ø–æ–ª—É—á–∏–ª —Ç–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∏ –Ω–∞—á–∏–Ω–∞—é –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫&nbsp;–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏. –°–∫–æ—Ä–æ —Å–≤—è–∂—É—Å—å —Å&nbsp;—Ç–æ–±–æ–π. –î–æ –≤—Å—Ç—Ä–µ—á–∏!</p>
</div>

<div class="footer">
  <div class="footer-bar"></div>
  <p>–ö–ê–ß–ê–õ–ö–ò–ù PRO ¬∑ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥</p>
</div>

<script>
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwpRqyMzV39Snq6VLMVkeVrsioDHIFaVpV6CPBSZpiBbQc5QGrekk2gz4AFnmL4_-HG/exec';
const LS_KEY = 'kachalkin_brief_v3';

const B = [
  { t:"–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ", ic:"üëã", q:[
    {id:"name", l:"–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", h:"–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è", type:"input"}
  ]},
  { t:"–û —Ç–µ–±–µ", ic:"üë§", q:[
    {id:"age_education",       l:"–°–∫–æ–ª—å–∫–æ —Ç–µ–±–µ –ª–µ—Ç? –ö–∞–∫–æ–µ —É —Ç–µ–±—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ?",               h:"–í—É–∑, —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –≥–æ–¥ –≤—ã–ø—É—Å–∫–∞ –∏–ª–∏ —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å"},
    {id:"additional_education", l:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ",                                h:"–ö—É—Ä—Å—ã, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –æ–±–ª–∞—Å—Ç–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞, PR, –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π"},
    {id:"experience",           l:"–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç",                              h:"–ö–æ–º–ø–∞–Ω–∏–∏, —Ä–æ–ª–∏, —Å—Ä–æ–∫–∏ ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ —Ñ—Ä–∏–ª–∞–Ω—Å"},
    {id:"languages",            l:"–ö–∞–∫–∏–º–∏ —è–∑—ã–∫–∞–º–∏ –≤–ª–∞–¥–µ–µ—à—å –∏ –Ω–∞ –∫–∞–∫–æ–º —É—Ä–æ–≤–Ω–µ?",                 h:"–ù–∞–ø—Ä–∏–º–µ—Ä: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π B2, —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π A1"}
  ]},
  { t:"–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è", ic:"üìç", q:[
    {id:"current_situation", l:"–ß–µ–º —Ç—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è —Å–µ–π—á–∞—Å?",                                   h:"–†–∞–±–æ—Ç–∞, —É—á—ë–±–∞, –ø—Ä–æ–µ–∫—Ç—ã"},
    {id:"likes_dislikes",    l:"–ß—Ç–æ –Ω—Ä–∞–≤–∏—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—à—å, –∞ —á—Ç–æ ‚Äî –Ω–µ—Ç?",                h:""},
    {id:"strengths",         l:"–ö–∞–∫–∏–µ —É —Ç–µ–±—è —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã?",                                h:"–ß—Ç–æ —Ö–æ—Ä–æ—à–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è? –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ—Ä–∞–º–∏"},
    {id:"challenges",        l:"–ß—Ç–æ –¥–∞—ë—Ç—Å—è —Ç—è–∂–µ–ª–æ –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ?",                h:""},
    {id:"ai_usage",          l:"–ò—Å–ø–æ–ª—å–∑—É–µ—à—å –ª–∏ —Ç—ã –ò–ò-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã?",                            h:"ChatGPT, Claude, Midjourney –∏ —Ç.–¥. ‚Äî –≤ —É—á—ë–±–µ, —Ä–∞–±–æ—Ç–µ, –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏. –ö–∞–∫ –∏–º–µ–Ω–Ω–æ?"}
  ]},
  { t:"–ó–∞–ø—Ä–æ—Å", ic:"üéØ", q:[
    {id:"main_question", l:"–ö–∞–∫–æ–π –≥–ª–∞–≤–Ω—ã–π –≤–æ–ø—Ä–æ—Å —Ç—ã —Ö–æ—á–µ—à—å —Ä–µ—à–∏—Ç—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏?",           h:"–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –∫–∞–∫ –º–æ–∂–µ—à—å, –∏–¥–µ–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω—É–∂–Ω–æ"},
    {id:"interests",     l:"–ö–∞–∫–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–µ/PR —Ç–µ–±–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã?",                 h:"–ë—Ä–µ–Ω–¥-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç, digital, –∫–æ–Ω—Ç–µ–Ω—Ç, PR, –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ, –ª–∏—á–Ω—ã–π –±—Ä–µ–Ω–¥, event –∏ —Ç.–¥."},
    {id:"role_models",   l:"–ï—Å—Ç—å –ª–∏ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –ª—é–¥–∏, –Ω–∞ —á—å—é –∫–∞—Ä—å–µ—Ä—É –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–µ—à—å—Å—è?",          h:""}
  ]},
  { t:"–û–±—Ä–∞–∑ –±—É–¥—É—â–µ–≥–æ", ic:"‚ú®", q:[
    {id:"career_3_5", l:"–ß—Ç–æ –¥–ª—è —Ç–µ–±—è ¬´—É—Å–ø–µ—à–Ω–∞—è –∫–∞—Ä—å–µ—Ä–∞¬ª —á–µ—Ä–µ–∑ 3‚Äì5 –ª–µ—Ç?",                      h:""},
    {id:"life_5_10",  l:"–ö–∞–∫ —Ç—ã –≤–∏–¥–∏—à—å —Å–≤–æ—é –∂–∏–∑–Ω—å —á–µ—Ä–µ–∑ 5‚Äì10 –ª–µ—Ç?",                            h:"–ù–µ —Ç–æ–ª—å–∫–æ —Ä–∞–±–æ—Ç–∞ ‚Äî –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏, —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã. –ë–µ–∑ ¬´–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö¬ª –æ—Ç–≤–µ—Ç–æ–≤"}
  ]},
  { t:"–†–µ—Å—É—Ä—Å—ã", ic:"‚ö°", q:[
    {id:"health",            l:"–ö–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞–µ—à—å —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ?",      h:"–ï—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —ç–Ω–µ—Ä–≥–∏—é –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å?"},
    {id:"constraints",       l:"–ï—Å—Ç—å –ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å?",                    h:"–ì–µ–æ–≥—Ä–∞—Ñ–∏—è, —Ñ–∏–Ω–∞–Ω—Å—ã, –≤—Ä–µ–º—è, –ª–∏—á–Ω—ã–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞"},
    {id:"previous_attempts", l:"–ß—Ç–æ —É–∂–µ –ø—Ä–æ–±–æ–≤–∞–ª–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞?",              h:"–ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∞ —á—Ç–æ –Ω–µ—Ç?"}
  ]},
  { t:"–í—Å—Ç—Ä–µ—á–∞", ic:"üìÖ", q:[
    {id:"preferred_datetime", l:"–ö–æ–≥–¥–∞ —Ç–µ–±–µ —É–¥–æ–±–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é?",                     h:"–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏ –Ω–µ–¥–µ–ª–∏, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞—Ç—ã"},
    {id:"format_preference",  l:"–ö–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç —É–¥–æ–±–Ω–µ–µ ‚Äî –æ—á–Ω–æ –∏–ª–∏ –æ–Ω–ª–∞–π–Ω?",                      h:"–ï—Å–ª–∏ –æ—á–Ω–æ ‚Äî —É–∫–∞–∂–∏ —Ä–∞–π–æ–Ω/–≥–æ—Ä–æ–¥, –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è"}
  ]},
  { t:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ", ic:"üí¨", q:[
    {id:"additional", l:"–ï—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë, —á—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –ø–µ—Ä–µ–¥ –≤—Å—Ç—Ä–µ—á–µ–π?", h:""}
  ]}
];

const TQ = B.reduce((a,b) => a + b.q.length, 0);
let cur = 0;
let A = {};
let prevBlkStatus = B.map(() => false);
let saveTimer = null;
let hintDismissed = false;

// === localStorage ===
function saveToLS() {
  try { localStorage.setItem(LS_KEY, JSON.stringify({ answers: A, cur: cur })); } catch(e) {}
}

function loadFromLS() {
  try {
    const d = JSON.parse(localStorage.getItem(LS_KEY));
    if (d && d.answers) { A = d.answers; cur = d.cur || 0; }
  } catch(e) {}
}

function clearLS() {
  try { localStorage.removeItem(LS_KEY); } catch(e) {}
}

function flashSave() {
  const badge = document.getElementById('saveBadge');
  badge.classList.add('show');
  clearTimeout(saveTimer);
  saveTimer = setTimeout(() => badge.classList.remove('show'), 1500);
}

// === beforeunload ===
window.addEventListener('beforeunload', function(e) {
  if (cnt() > 0 && !document.getElementById('done').classList.contains('show')) {
    e.preventDefault();
    e.returnValue = '';
  }
});

// === Compact header on scroll ===
let lastScroll = 0;
window.addEventListener('scroll', function() {
  const h = document.getElementById('header');
  if (window.scrollY > 200) h.classList.add('compact');
  else h.classList.remove('compact');

  // Hide hint after first scroll
  if (!hintDismissed && window.scrollY > 50) {
    hintDismissed = true;
    document.getElementById('tabsHint').classList.add('hidden');
  }
}, { passive: true });

// === Helpers ===
const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const cnt = () => Object.values(A).filter(v => v && v.trim()).length;
const blkDone = i => B[i].q.every(q => A[q.id] && A[q.id].trim());
const blkCnt = i => B[i].q.filter(q => A[q.id] && A[q.id].trim()).length;
const pl = n => n===1 ? '–≤–æ–ø—Ä–æ—Å' : n>=2&&n<=4 ? '–≤–æ–ø—Ä–æ—Å–∞' : '–≤–æ–ø—Ä–æ—Å–æ–≤';

function updProg() {
  const c = cnt();
  document.getElementById('pFill').style.width = Math.round(c / TQ * 100) + '%';
  document.getElementById('pText').textContent = c + ' / ' + TQ;
}

// === Section dots ===
function mkDots() {
  const el = document.getElementById('sDots');
  el.innerHTML = '';
  B.forEach((b, i) => {
    const d = document.createElement('div');
    d.className = 's-dot' + (blkDone(i) ? ' done' : (i === cur ? ' active' : ''));
    el.appendChild(d);
  });
}

// === Tabs ‚Äî only rebuild when block status changes ===
function mkTabs(scrollToActive) {
  const el = document.getElementById('tabs');
  el.innerHTML = '';
  B.forEach((b, i) => {
    const t = document.createElement('button');
    t.className = 'tab-btn' + (i === cur ? ' active' : '');
    t.setAttribute('role', 'tab');
    t.setAttribute('aria-selected', i === cur ? 'true' : 'false');
    const chk = blkDone(i) ? ' <span class="cm">‚úì</span>' : '';
    t.innerHTML = b.ic + ' ' + b.t + chk;
    t.onclick = () => go(i);
    el.appendChild(t);
  });
  if (scrollToActive) {
    const active = el.querySelector('.active');
    if (active) active.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
  }
  prevBlkStatus = B.map((_, i) => blkDone(i));
}

function maybeUpdateTabs() {
  const newStatus = B.map((_, i) => blkDone(i));
  const changed = newStatus.some((s, i) => s !== prevBlkStatus[i]);
  if (changed) {
    mkTabs(false);
    mkDots();
  }
}

// === Form ===
function mkForm() {
  const el = document.getElementById('formArea');
  const b = B[cur];
  let n = 0;
  for (let i = 0; i < cur; i++) n += B[i].q.length;

  const filled = blkCnt(cur);
  const total = b.q.length;
  const isComplete = filled === total;

  let h = '<form class="section" onsubmit="return false" role="group" aria-label="' + esc(b.t) + '">';
  h += '<div class="section-head"><div class="section-head-left"><div class="section-badge">' + b.ic + '</div><div><div class="section-name">' + b.t + '</div><div class="section-qty">' + total + ' ' + pl(total) + '</div></div></div>';
  h += '<div class="section-progress' + (isComplete ? ' complete' : '') + '">' + filled + ' / ' + total + '</div></div>';

  b.q.forEach(q => {
    n++;
    const v = A[q.id] || '';
    const f = v.trim() ? ' filled' : '';
    const fid = 'inp_' + q.id;

    h += '<div class="q-card' + f + '" id="card_' + q.id + '">';
    h += '<div class="q-num">–í–æ–ø—Ä–æ—Å ' + n + '</div>';
    h += '<div class="q-label-row"><label class="q-label" for="' + fid + '">' + q.l + '</label><span class="q-filled-check">‚úì</span></div>';
    if (q.h) h += '<div class="q-hint">' + q.h + '</div>'; else h += '<div class="q-hint"></div>';

    if (q.type === 'input') {
      h += '<input type="text" id="' + fid + '" name="' + q.id + '" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç..." value="' + esc(v) + '" aria-label="' + esc(q.l) + '">';
    } else {
      h += '<textarea id="' + fid + '" name="' + q.id + '" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç..." aria-label="' + esc(q.l) + '">' + esc(v) + '</textarea>';
    }
    h += '</div>';
  });

  h += '<div class="nav-row">';
  h += cur > 0 ? '<button type="button" class="btn btn-back" onclick="go(' + (cur - 1) + ')">‚Üê –ù–∞–∑–∞–¥</button>' : '<div></div>';
  if (cur < B.length - 1) {
    h += '<button type="button" class="btn btn-fwd" onclick="go(' + (cur + 1) + ')">–î–∞–ª–µ–µ ‚Üí</button>';
  } else {
    h += '<button type="button" class="btn btn-send" id="sendBtn" onclick="preSend()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –±—Ä–∏—Ñ ‚úì</button>';
  }
  h += '</div></form>';
  el.innerHTML = h;

  // Attach live input listeners (no re-render on type)
  b.q.forEach(q => {
    const inp = document.getElementById('inp_' + q.id);
    if (inp) {
      inp.addEventListener('input', function() {
        A[q.id] = this.value;
        updProg();
        saveToLS();
        flashSave();

        const card = document.getElementById('card_' + q.id);
        if (this.value.trim()) card.classList.add('filled');
        else card.classList.remove('filled');

        // Update section progress counter
        const sp = document.querySelector('.section-progress');
        const fc = blkCnt(cur);
        sp.textContent = fc + ' / ' + b.q.length;
        if (fc === b.q.length) sp.classList.add('complete');
        else sp.classList.remove('complete');

        maybeUpdateTabs();
      });
    }
  });
}

function go(i) {
  cur = i;
  saveToLS();
  mkTabs(true);
  mkDots();
  mkForm();
  window.scrollTo({ top: 0 });
}

// === Pre-send validation ===
function preSend() {
  const filled = cnt();
  const empty = TQ - filled;

  let msg = '';
  if (empty === TQ) {
    msg = '<span class="warn">–í—Å–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ.</span> –£–≤–µ—Ä–µ–Ω(–∞), —á—Ç–æ —Ö–æ—á–µ—à—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π –±—Ä–∏—Ñ?';
  } else if (empty > 0) {
    msg = '–ó–∞–ø–æ–ª–Ω–µ–Ω–æ <strong>' + filled + ' –∏–∑ ' + TQ + '</strong> –≤–æ–ø—Ä–æ—Å–æ–≤. –ù–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è: ' + empty + '.<br>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å?';
  } else {
    msg = '–í—Å–µ <strong>' + TQ + '</strong> –≤–æ–ø—Ä–æ—Å–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º?';
  }

  document.getElementById('modalText').innerHTML = msg;
  document.getElementById('confirmModal').classList.add('show');
}

function closeModal() {
  document.getElementById('confirmModal').classList.remove('show');
}

async function confirmSend() {
  closeModal();
  const btn = document.getElementById('sendBtn');
  if (btn) btn.disabled = true;
  document.getElementById('overlay').classList.add('show');
  document.getElementById('errorBanner').classList.remove('show');

  let success = false;
  try {
    // Use form-encoded to avoid CORS issues
    const params = new URLSearchParams();
    for (const [k, v] of Object.entries(A)) {
      params.append(k, v || '');
    }
    params.append('_timestamp', new Date().toISOString());

    const resp = await fetch(SCRIPT_URL, {
      method: 'POST',
      body: params
    });

    // If we get any response, treat as success (Google Scripts redirects)
    success = true;
  } catch(e) {
    // With Google Apps Script, even failed CORS can mean success
    // Try a no-cors fallback
    try {
      const params = new URLSearchParams();
      for (const [k, v] of Object.entries(A)) {
        params.append(k, v || '');
      }
      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: params
      });
      success = true;
    } catch(e2) {
      console.error('Send failed:', e2);
    }
  }

  document.getElementById('overlay').classList.remove('show');

  if (success) {
    clearLS();
    document.getElementById('formArea').style.display = 'none';
    document.getElementById('tabs').style.display = 'none';
    document.getElementById('sDots').style.display = 'none';
    document.getElementById('tabsHint').style.display = 'none';
    document.getElementById('done').classList.add('show');
    // Show actual filled count, not forced 100%
    const c = cnt();
    document.getElementById('pFill').style.width = '100%';
    document.getElementById('pText').textContent = c + ' / ' + TQ;
  } else {
    if (btn) btn.disabled = false;
    document.getElementById('errorBanner').classList.add('show');
    setTimeout(() => document.getElementById('errorBanner').classList.remove('show'), 6000);
  }
}

// === Init ===
loadFromLS();
mkTabs(false);
mkDots();
mkForm();
updProg();
</script>

</body>
</html>
